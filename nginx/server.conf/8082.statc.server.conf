# 静态资源服务

server {
	listen 8082;
	server_name local_static.com;
    charset utf-8;

	gzip  on; 
    gzip_min_length 1k;

    # Nginx访问日志存放位置
    access_log  /Users/qinmao/Desktop/demo-pro/demo-nginx/logs/local_static.com_access.log custom;  
    error_log   /Users/qinmao/Desktop/demo-pro/demo-nginx/logs/local_static.com_error.log;  

    # 注意权限问题：确保 Nginx 进程有权访问静态资源目录，通常需要将目录的权限设置为可读取的
    # sudo chown -R www-data:www-data /var/www/html  # 在 Ubuntu/Debian 上
    # sudo chown -R nginx:nginx /var/www/html        # 在 CentOS/RHEL 上
    # sudo chmod -R 755 /var/www/html                # 确保目录和文件的权限设置正确

    root  /Users/qinmao/Desktop/demo-pro;  # 设置静态资源根目录
    # index index.html index.htm;  # 默认首页文件

    # 对于 /report.html，直接返回该文件并禁用访问日志
    location ^~ /report.html {
        access_log off;  
        try_files /demo-nginx/html/report.html =404;  # 确保返回该文件，如果文件不存在则返回 404
    }

    location / {       
        autoindex            on;  # 开启静态资源列目录
        autoindex_exact_size off; # on(默认)显示文件的实际大小，单位是byte； off 显示文件的实际大小而不是 1K、1M 等
        autoindex_localtime  on; # off(默认)时显示的文件时间为GMT时间；on 显示的文件时间为服务器时间
        # set $limit_rate      1k;  # 限流每秒1字节，保护带宽
        try_files $uri $uri/ =404;  # 如果请求的文件不存在，返回 404 错误
    }

    # 配置静态文件的缓存策略（可选）
    location ~* \.(jpg|jpeg|png|gif|css|js|ico|svg|woff|woff2)$ {
        expires 30d;     # 设置静态资源的缓存时间为 30 天
        access_log off;  # 禁止访问日志
    }

    #error_page  404              /404.html;

    # redirect server error pages to the static page /50x.html
    #

    # 图片防盗链 （新解决方案 secure_link 模块）
    # 限制只有特定的域名（如 yourdomain.com）可以访问图片资源，其他外部站点则无法访问
    location ~* \.(jpg|jpeg|png|gif|bmp|webp|svg)$  {
        valid_referers none blocked yourdomain.com www.yourdomain.com;  
        if ($invalid_referer){
            return 403;
        }
    }
}