# 进程与线程
进程（Process）和线程（Thread）是操作系统中管理任务执行的两个重要概念。理解它们的区别和关系，有助于更好地掌握操作系统的工作原理和并发编程。

## 进程（Process）
* 概念
  - 进程是操作系统进行资源管理和调度的基本单位，它是程序在计算机上执行时的实例
  - 每个进程都有自己的内存空间、系统资源和执行状态。可以将进程看作是一个具有独立资源的程序实例，- 进程间是相互隔离的，彼此无法直接访问对方的内存空间。
* 特点
  - 独立性：进程之间有独立的地址空间，互相之间不能直接访问。
  - 资源拥有：每个进程拥有独立的资源，如内存、文件句柄等。
  - 通信：进程之间的通信需要通过特定的机制（如管道、共享内存、消息队列等）进行，称为进程间通信（IPC）。
  - 开销较大：由于进程有独立的内存空间和资源管理，创建和销毁进程的开销较大。
* 进程的生命周期：
  - 创建：操作系统为进程分配资源，进行初始化。
  - 执行：进程处于运行状态，执行程序中的指令。
  - 阻塞/等待：进程因某些事件（如 I/O 操作）而进入阻塞状态，等待资源或事件完成。
  - 结束：进程执行完成或被终止，操作系统回收其资源。
* 进程的管理：
  - 操作系统通过调度算法控制进程的执行顺序，不同的进程会按优先级、时间片等策略交替执行。

## 线程（Thread）
* 概念
  - 线程是操作系统调度的最小单位，每个进程至少有一个主线程，也可以有多个子线程
  - 线程是共享进程资源的执行单元,线程间共享进程的内存空间和资源，但每个线程有自己的寄存器、栈等执行状态
* 线程的特点：
  - 轻量级：线程共享进程的内存和资源，因此创建、销毁线程的开销相对较小。
  - 共享资源：线程共享进程的内存空间和文件句柄等资源，但每个线程有独立的栈和寄存器。
  - 并发性：线程可以并发执行，多个线程可以在同一个进程内独立执行不同的任务。
  - 上下文切换快：线程切换的上下文较小，开销较低，效率比进程切换高。
* 线程的生命周期：
  - 创建：线程由进程创建，并分配一个线程控制块（TCB）。
  - 就绪：线程准备好执行，但尚未获得 CPU 时间。
  - 运行：线程获得 CPU 时间并正在执行。
  - 阻塞/等待：线程因 I/O 操作、同步操作等原因进入阻塞状态。
  - 结束：线程执行完毕或被终止，操作系统回收线程资源。

## 并发与并行
* 并发：是指多个任务在同一时间段内进行，任务之间可能交替进行，也可能在不同的时间片上轮流执行。进程和线程的调度都属于并发执行。
* 并行：是指多个任务在同一时刻同时执行，这通常依赖于多核处理器。并行计算通常需要多进程或多线程配合硬件支持。

## 应用场景
* 多进程：指操作系统同时运行多个进程，它们各自独立执行，不共享内存空间。适合需要隔离性、容错性较高的场景。
* 多线程：指在同一个进程中并发运行多个线程，它们共享同一块内存空间。适合需要高并发、低延迟、资源共享的场景。如用于计算密集型或 I/O 密集型的任务


## Linux中进程管理
* 进程的控制命令
  - ps| pstree 提供了进程的一次性的查看,它所提供的查看结果并不动态连续的
    ```bash
        # a 显示一个终端的所有进程，除会话引线外；
        # u：显示进程的归属用户及内存的使用情况；
        # x：显示没有控制终端的进程；

        # 列出全部进程信息
        # a 表示显示所有用户的进程，u 显示详细的用户信息，x 显示没有控制终端的进程。
        ps aux

        # 类似于 ps aux，但格式不同。
        # -e 显示全部的进程
        # -f 以完全格式化的形式展示信息
        ps -ef

        ps -u <用户名>： # 显示指定用户的所有进程。
        ps -p <PID>：   # 显示指定 PID 的进程信息。
        ps -ejH         # 来显示进程树

        # 过滤并获得包含 node 在内的所有进程
        ps -ef | grep node 

        ps aux --sort=-%mem： # 按内存使用量降序排列显示所有进程。
        ps aux --sort=-%cpu： # 按 CPU 使用量降序排列显示所有进程。
        
        # 查看线程
        ps -eLf | more
        
        # 关闭进程 -9 表示强制关闭
        kill -9 进程id  
    ```
  - top:动态查看进程信息,可以用来监控系统的资源使用情况（如 CPU、内存、磁盘等）。 默认每5s刷新一次
    ```bash
      # PID: 进程ID
      # USER: 进程所属的用户
      # PR: 进程优先级
      # NI: 进程的nice值
      # VIRT: 进程使用的虚拟内存
      # RES: 进程使用的物理内存
      # SHR: 共享内存
      # S: 进程状态（S：睡眠，R：运行，Z：僵尸等）
      # %CPU: 进程占用的 CPU 百分比
      # %MEM: 进程占用的内存百分比
      # TIME+: 进程使用的总 CPU 时间
      # COMMAND: 进程名称或命令
      top # 实时更新的方式显示当前系统中各个进程的详细信息

      # 常用命令
      # -p 只显示某个进程的信息 -i 不显示任何闲置的进程
      top -d <秒数>:   # 设置更新间隔时间（单位为秒）。
      top -u <用户名>:  # 显示某个用户的进程。
      top -p <pid1>,<pid2>,...: # 只显示特定进程的状态。
      top -b:         # 以批处理模式运行，适合输出到文件。

      # 在 top 中的一些快捷键：
      #  M：按内存使用量排序。
      #  P：按 CPU 使用量排序。
      #  q：退出 top 命令。
      #  h：显示帮助信息。
    ```
* 服务管理工具
  > 控制服务启动。停止、开启
  ```bash
    # 开机自启动 如防火墙
    systemctl enable firewalld 
    # 关闭开机自启动
    systemctl disable firewalld 
  ```  