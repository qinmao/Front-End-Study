<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>桌面捕获</title>
        <style>
            * {
                margin: 0;
                padding: 0;
            }
            #remote-video {
                width: 100%;
                height: 100vh;
                object-fit: fill;
                /* border: 1px solid red; */
                /* 水平翻转 */
                /* transform: scaleX(-1); */
            }
        </style>
    </head>
    <body>
        <video src="" id="remote-video"></video>
        <script>
            const remoteVideo = document.querySelector("#remote-video");
            // // 检查浏览器是否支持自动播放，如果支持则使用 playsinline 或 muted 属性
            // if ('playsInline' in remoteVideo) {
            //   remoteVideo.playsInline = true // iOS 10+ Safari 需要这个属性
            //     remoteVideo.muted = true // 自动播放需要静音
            // }

            remoteVideo.addEventListener(
                "loadedmetadata",
                function () {
                    // 当视频的元数据已加载后，再尝试播放
                    remoteVideo
                        .play()
                        .then(() => {
                            // 播放成功
                            console.log("播放成功");
                        })
                        .catch((error) => {
                            // 处理播放错误
                            console.error("播放失败:", error);
                        });
                },
                false
            );

            async function startCapture() {
                let captureStream = null;
                try {
                    captureStream =
                        await navigator.mediaDevices.getDisplayMedia({
                            video: true,
                        });
                } catch (err) {
                    console.error("Error: " + err);
                }
                return captureStream;
            }
            startCapture().then((captureStream) => {
                remoteVideo.srcObject = captureStream;
            });
        </script>
    </body>
</html>
