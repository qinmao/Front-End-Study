<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>音视频</title>
        <style>
            #video {
                /* 水平翻转 */
                transform: scaleX(-1); 
            }
        </style>
    </head>
    <body>
        <video src="" id="video"></video>
        <script>
            function handleStream(stream) {
                const video = document.querySelector("#video");
                video.srcObject = stream;
                video.onloadedmetadata = (e) => video.play();
            }

            function handleError(e) {
                console.log(e);
            }
            // 检查音视频权限
            // 如果存在多个摄像头， navigator.mediaDevices.enumerateDevices() 获取所有设备信息
            // video:{ deviceId:xxxx } 指定用某个设备，不可用时随机返回一个可用的
            // video:{ deviceId:{exact:xxxx} } 指定用某个设备，不可用报错

            navigator.mediaDevices
                .getUserMedia({ audio: true, video: true })
                .then(function (stream) {
                    // 用户已授予音视频权限
                    handleStream(stream);
                })
                .catch(function (err) {
                    if (
                        err.name === "NotAllowedError" ||
                        err.name === "PermissionDeniedError"
                    ) {
                        // 用户拒绝了音视频权限，可以在此处提示用户开启权限
                        console.log("用户拒绝了音视频权限,请点击允许");
                    } else if (
                        err.name === "NotFoundError" ||
                        err.name === "DevicesNotFoundError"
                    ) {
                        // 没有检测到音视频设备
                        console.log("没有检测到音视频设备");
                    } else {
                        // 其他错误，可以进行相应处理
                        console.log("其他错误");
                    }
                });
        </script>
    </body>
</html>
