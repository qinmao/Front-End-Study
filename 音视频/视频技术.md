# 视频技术

## 图像的基础和前处理
> 视频图像的基本概念
* 帧率：
  - 现在的摄像头功能已非常强大，一般情况下，一秒钟可以采集 30 张以上的图像，一些好的摄像头甚至可以采集 100 张以上。我们把摄像头一秒钟采集图像的次数称为帧率。帧率越高，视频就越平滑流畅。然而，在直播系统中一般不会设置太高的帧率，因为帧率越高，占的网络带宽就越多。
* 分辨率：
  - 摄像头除了可以设置帧率之外，还可以调整分辨率。我们常见的分辨率有 2K、1080P、720P、420P 等。
  - 分辨率越高图像就越清晰，但同时也带来一个问题，即占用的带宽也就越多。所以，在直播系统中，分辨率的高低与网络带宽有紧密的联系。也就是说，分辨率会跟据你的网络带宽进行动态调整。
* 宽高比：
  - 分辨率一般分为两种宽高比，即 16:9 或 4:3。
  - 4:3 的宽高比是从黑白电视而来，而 16:9 的宽高比是从显示器而来。现在一般情况下都采用 16:9 的比例
* 图像的颜色空间 YUV & RGB
  - GRAY：早期黑白电视的图像就是以 GRAY 的方式展现的图像。这一模式为 8 位展示的灰度，取值 0-255，0 为最黑暗的模式，255 为最亮的模式
  - YUV：主要用于电视系统以及模拟视频领域。它将亮度信息（Y）与色彩信息（UV）分离，即使没有 UV 信息一样可以显示完整的图像，只不过是黑白的，它解决了彩色电视机与黑白电视的兼容问题，最大的优点在于每个像素点的色彩表示值占用的带宽或者存储空间非常少
  - RGB：将红（Red）、绿（Green）、蓝（Blue）三原色的色光按照不同的比例相加，来合成各种色彩光
  - HSL 与 HSV：HSL 和 HSV 是将 RGB 色彩模型中的点放在圆柱坐标系中的表示法， 色相（Hue）、饱和度（ Saturation）、亮度（ Lightness）、明度（Value）

* 图像的缩放算法

## 视频编码
* 视频编码原理
  - 视频的 PCM 数据、视频的 YUV 和 RGB 的图像数据直接存储或者通过带宽传输会比较消耗空间，那么为了节省存储，或者确保占用的带宽更少一些，就需要把音频、视频的数据压缩一下
* 非编码帧（解码帧）
  - 播放器播的是非编码帧（解码后的帧），这些非编码帧就是一幅幅独立的图像
  - 从摄像头里采集的帧或通过解码器解码后的帧都是非编码帧。
  - 非编码帧的格式一般是 YUV 格式或是 RGB 格式
* 编码帧
  - 通过编码器（如 H264/H265、VP8/VP9）压缩后的帧称为编码帧
  + 以 H264 为例，经过 H264 编码的帧包括以下三种类型
    - I 帧：关键帧。压缩率低，可以单独解码成一幅完整的图像。
    - P 帧：参考帧。压缩率较高，解码时依赖于前面已解码的数据
    - B 帧：前后参考帧。压缩率最高，解码时不光依赖前面已经解码的帧，而且还依赖它后面的 P 帧
* 编解码技术的演进
  - H264/H265、VP8/VP9 以及后面的 AV1 编解码器，解决了视频压缩率的问题
* H264码流结构
* 帧内预测
* 帧间预测
* 变换和量化

## 视频传输和网络对抗
* 常见的实时媒体流协议及其适用场景
  - 实时媒体流指通过网络传输的实时音频和视频数据，为了确保数据的及时性和流畅性，通常会使用特定的协议来传输这些数据
  + RTP (Real-time Transport Protocol):
    - 场景：RTP 是一个标准的实时音频和视频传输协议，通常与RTCP（RTP Control Protocol）一起使用，用于传输多媒体数据，如语音电话、视频会议等实时通信场景。
    - 特点：支持实时数据传输、时间同步、延迟控制等功能，常用于需要即时性和低延迟的应用中。
  + RTSP (Real-time Streaming Protocol):
    - 场景：RTSP 是一种客户端和服务器之间用来控制多媒体流传输的应用层协议，常用于流媒体服务、IP 监控摄像头等需要远程控制和实时传输的场景。
    - 特点：RTSP 本身不传输数据，而是建立和控制流媒体会话的控制协议，通常与 RTP 结合使用，用于实时媒体流的控制和管理。
  + RTMP 协议：
    - 场景：Real-Time Messaging Protocol (RTMP): 主要用于 Flash Player，但现代浏览器已经逐渐不再支持 Flash。
  + WebRTC (Web Real-Time Communication):
    - 场景：WebRTC 是一种支持浏览器之间点对点实时音视频通信的开放标准，常用于视频会议、在线教育、远程协作等应用。
    - 特点：通过在浏览器中直接使用 JavaScript API，实现音频、视频和数据的传输，无需安装插件，支持高质量的实时通信。
  + SRT (Secure Reliable Transport):
    - 场景：SRT 是一种用于流媒体传输的开源协议，特别适用于要求高可靠性、安全性和稳定性的场景，如远程直播、远程采访等。
    - 特点：通过使用 FEC（Forward Error Correction）和 ARQ（Automatic Repeat reQuest）等技术来增强传输的稳定性和可靠性，支持传输过程中的数据加密和认证。
  + HLS (HTTP Live Streaming):
    - 场景：HLS 是一种基于 HTTP 的流媒体传输协议，主要用于向移动设备和桌面端传输音频和视频流，适合广播电视、OTT（Over-the-Top）服务等。
    - 特点：HLS 将整个媒体文件分成短小的 HTTP 下载流，每个流以 MPEG-2 Transport Stream（MPEG-TS）格式传输，利用 HTTP 服务器进行内容传输，支持自适应码率和跨平台播放。
    > h5支持播放:HLS (.m3u8) 或 MPEG-DASH (.mpd)。

* RTP & RTCP 协议 和 H264 的RTP 打包
* 带宽预测
* 视频编码码控原理及算法
* 视频花屏卡顿的产生原因及处理方法
* 可伸缩编码 SVC

## 视频封装和播放
* 视频封装技术 MPC & FLV
* 视频渲染和音画同步的基本方法