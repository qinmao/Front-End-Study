# 鉴权与登录
## 前置的知识
* 什么是认证？
  - 是指根据声明者所特有的识别信息，确认声明者的身份。
  + 常见的认证技术：
    - 身份证
    - 用户名和密码
    - 用户手机：手机短信、手机二维码扫描、手势密码
    - 用户的电子邮箱
    - 用户的生物学特征：指纹、语音、眼睛虹膜
    - 用户的大数据识别
* 什么是授权？
  - 在信息安全领域是指资源所有者委派执行者，赋予执行者指定范围的资源操作权限，以便对资源的相关操作。
  - 在互联网领域例如： web 服务器的 session 机制、web 浏览器的 cookie 机制、颁发授权令牌（token）等都是一个授权的机制。
* 什么是鉴权？
  - 在信息安全领域是指对于一个声明者所声明的身份权利，对其所声明的真实性进行鉴别确认的过程。
* 认证、授权、鉴权和权限控制的关系？
  ![关系](./imgs/%E5%85%B3%E7%B3%BB.webp)

## 背景（为什么要有鉴权登录认证）
  - 由于 http 是无状态协议，导致页面关闭后无法区分是哪个用户发送的请求
  - 在互联网领域： 校验 session/cookie/token 的合法性和有效性
## 传统的登录验证
* 认证流程
  - 前端通过 Web 表单将用户名和密码发送到后端
  - 后端校验通过以后，将用户不敏感的信息（id,email,role等）作为 JWT 的 PayLoad，将其和 Header 分别进行 Base64 编码拼接后，进行签名（Signature），形成一个 Token （JWT）。
  - 后端把 Token 字符串作为登录成功的结果返回给前端，前端可以将返回的结果保存在 localStorage（本地缓存）中，退出登录时前端删除掉 Token 即可。
  - 前端可以在每次请求的时候把 Token 放到 HTTP Header 的 Authorization 中（解决XSS/XSRF攻击问题）
  - 后端检查前端发送的 Token 是否存在（检查签名是否正确、Token是否过期等）
  - 验证成功后，再取 payload 出里面的信息（如username），再使用该信息直接查询用户信息完成需要的后续业务逻辑。
* 优点
  - 不需要在服务端保存会话信息，节省服务器的资源开销
  - PayLoad中包含了用户的部分信息，避免多次查询数据库
* jwt的组成：
    - 标头(Header)：通常由两部分组成 令牌的类型（即 JWT ）和所使用的签名算法
    ```js
        {
        "alg" : "HS256",
        "typ" : "JWT"
        }

    ```
    - 有效载荷(Payload)是有关实体（通常是用户信息）和其他数据的声明,不要在 Payload 中存放用户的敏感信息（比如：密码）
    ```js
        {
            "sub" : "1234567890",
            "name" : "John Doe",
            "admin" : true
        }
    ```
    - 签名(Signature):前面两部分都是使用 Base64 进行编码的，即前端可以解开知道里面的信息。Signature 需要使用编码后的 header 和 payload 以及我们提供的一个密钥，然后使用 header 中指定的签名算法(HS256)进行签名。签名的作用是保证 JWT 没有被篡改过
## 外接平台登录验证：微信、钉钉、飞书
